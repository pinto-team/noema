# NOEMA • config/safety.yaml
# Runtime safety policies for the shield (safety/*).

policies:

  - id: "deny_shell"
    desc: "Block direct shell/OS command execution."
    when:
      actions: ["run_shell", "call_os", "exec_command"]
      text_matches:
        deny:
          - '(?i)\b(?:bash|sh|zsh|rm\s+-rf|powershell|cmd\.exe|del\s+/f)\b'
    effect: "block"
    risk_delta: 0.6
    message: "Shell/OS command execution is not allowed."

  - id: "ask_for_clarification_low_conf"
    desc: "If confidence is low or uncertainty is high, ask to clarify."
    when:
      intents: ["unknown", "smalltalk"]
    effect: "review"
    risk_delta: 0.2
    message: "Please clarify what you would like me to do."

  - id: "compute_invalid_expr"
    desc: "When intent is compute, if expression looks invalid → review."
    when:
      intents: ["compute"]
      text_matches:
        deny:
          # Disallow any char outside the safe set. Arabic-Indic digits are accepted for convenience.
          - '[^0-9\u06F0-\u06F9\u0660-\u0669+\-*/()\t ]'
    effect: "review"
    risk_delta: 0.1
    message: "Invalid math expression. Please use only numbers and + - * / and parentheses."
